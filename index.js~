'use strict'

var fs = require('fs');
var nodemailer = require('nodemailer');
var config = require('node-config');
var filepath = '/home/tatiana/motion/motionshot.jpg';

var smtpConfig = {
    host: 'smtp.gmail.com',
    secure: true, 					                              // use SSL
    auth: {
        user: 'pedro.posada@pslgroup.com',
        pass: 'qvilbwrmgtarszyb'
    }
};

var transporter = nodemailer.createTransport(smtpConfig);

// setup e-mail data
var mailOptions = {
    from: '"Pedro Posada" <pedro.posada@pslgroup.com>',   // sender address
    to: 'yo@pedroposada.com', 				                    // list of receivers
    subject: 'webcam motionshot', 			                  // Subject line
    text: 'See attachment', 				                      // plaintext body
    attachments: [
	{
	  path: filepath	
	}
    ]
};

fs.watchFile(filepath, { persistent: true, interval: 10000 }, function(curr, prev) {
  console.log('image was modified');
  
  // send mail with defined transport object
  transporter.sendMail(mailOptions, function(error, info){
    if(error){
      return console.log(error);
    }
    console.log('Message sent: ' + info.response);
  });	
});

